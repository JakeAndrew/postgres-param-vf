Account
    balance Milray

Payday
    date UTCTime


Transaction
    ts     UTCTime
    credit AccountId Maybe
    debit  AccountId Maybe
    payday PaydayId  Maybe
    amount Milray
    reason Text
    info   Text      Maybe

User
    ident             Text
    email             Text         Maybe
    email_verified    Bool                  default=false
    createdTs         UTCTime
    hash              Text         Maybe
    salt              Text         Maybe
    name              Text         Maybe
    account           AccountId
    avatar            Text         Maybe
    blurb             Markdown     Maybe
    statement         Markdown     Maybe
    ircNick           Text         Maybe
    languages         [Language]
    readApplications  UTCTime            default=now()
    established       Established        default='EstUnestablished'

    UniqueUser ident
    UniqueUserAccount account

    deriving Show Typeable

ResetPassphrase
    user  UserId
    email Text
    uri   Text
    sent  Bool   default=false  -- for the email daemon

    UniquePassphraseReset user email uri

EmailVerification
    user  UserId
    email Text   -- user's email at the time when the 'uri' was generated
    uri   Text                  -- verification link
    sent  Bool   default=false  -- was it sent by the email daemon?

    UniqueEmailVerification user email uri

DeleteConfirmation
    user  UserId
    email Text
    uri   Text
    sent  Bool   default=false  -- for the email daemon

    UniqueDeleteConfirmation user email uri

-- User-watching-project relation
UserWatchingProject
    user    UserId
    project ProjectId

    UniqueUserWatchingProject user project

-- TODO(mitchell) is this used?
UserSetting
    user    UserId
    setting UserSettingName
    value String

ViewTime
    user    UserId
    project ProjectId
    type    ViewType
    time    UTCTime   default=now()

    UniqueViewTimeUserProjectType user project type

License
    name         LicenseName
    type         LicenseType
    projectTypes [LicenseProjectType]
    text         LicenseText
    website      LicenseWebsite

    deriving Read Show Eq

Project
    createdTs   UTCTime
    name        Text
    handle      Text
    blurb       Text
    description Markdown
    account     AccountId
    shareValue  Milray
    lastPayday  PaydayId     Maybe
    githubRepo  Text         Maybe
    public      Bool               default=true
    logo        Text         Maybe

    UniqueProjectAccount account
    UniqueProjectHandle handle

    deriving Eq Show

ProjectSignup
    name               ProjectSignupName
    website            ProjectSignupWebsite             Maybe
    handle             ProjectSignupHandle
    startDate          ProjectSignupStartDate
    licenses           [ProjectSignupLicense]
    licensesComment    ProjectSignupLicenseComment      Maybe
    categories         [ProjectSignupCategory]
    categoriesComment  ProjectSignupCategoryComment     Maybe
    location           ProjectSignupLocation            Maybe
    legalStatus        ProjectSignupLegalStatus
    legalStatusComment ProjectSignupLegalStatusComment  Maybe
    coopStatus         ProjectSignupCoopStatus
    applicantRole      ProjectSignupApplicantRole
    mission            ProjectSignupMission
    goals              ProjectSignupGoals
    fundsUse           ProjectSignupFundsUse
    additionalInfo     ProjectSignupAdditionalInfo      Maybe

    deriving Show

ProjectUserRole
    project ProjectId
    user    UserId
    role    Role

    UniqueProjectUserRole project user role

    deriving Show

ProjectUpdate
    updatedTs   UTCTime
    project     ProjectId
    author      UserId
    blurb       Text
    description MarkdownDiff

ProjectLastUpdate
    project ProjectId
    update  ProjectUpdateId

    UniqueProjectLastUpdate project

-- Parts of Pledge are duplicated in EventDeletedPledge.
-- If you modify Pledge, be sure to (possibly) modify
-- EventDeletedPledge as well!
Pledge
    createdTs    UTCTime default=now()
    user         UserId
    project      ProjectId
    shares       Int64
    fundedShares Int64

    UniquePledge user project

Invite
    createdTs  UTCTime
    project    ProjectId
    code       Text
    user       UserId
    role       Role
    tag        Text
    redeemed   Bool
    redeemedTs UTCTime   Maybe
    redeemedBy UserId    Maybe

    UniqueInvite code

VolunteerApplication
    createdTs        UTCTime
    project          ProjectId
    user             UserId
    name             Text
    email            Text
    otherContactInfo Text      Maybe
    website          Text      Maybe
    location         Text      Maybe
    experience       Textarea  Maybe
    comments         Textarea  Maybe

Interest
    description Text

VolunteerInterest
    volunteer VolunteerApplicationId
    interest  InterestId

Tag
    name      Text
    UniqueTag name

ProjectTag
    project ProjectId
    tag     TagId

    UniqueProjectTag project tag

DeprecatedTag
    project ProjectId
    tag TagId
    reason Text

Build
    bootTime UTCTime
    base     Text
    diff     Text

-- A User may be established by a number of different ways. Manual
-- establishment by a moderator is one of them.
ManualEstablishment
    establishedUser  UserId
    establishingUser UserId

    UniqueManualEstablishment establishedUser

TagColor
    tag   TagId
    user  UserId
    color Int

    UniqueTagColor tag user

    deriving Typeable

DefaultTagColor
    tag   TagId
    color Int

    UniqueDefaultTag tag

DatabaseVersion
    lastMigration Int

PledgeFormRendered
    ts      UTCTime
    order   Text
    project ProjectId
    user    UserId    Maybe

SharesPledged
    ts      UTCTime
    user    UserId
    project ProjectId
    shares  Int64
    render  PledgeFormRenderedId

Image
    ts UTCTime
    uploader UserId
    project ProjectId Maybe
    name Text
    origin Text Maybe
    format ContentType
    data ByteString
    UniqueImageHandle name

UnnamedImage
    ts UTCTime
    uploader UserId
    project ProjectId Maybe
    name Text Maybe
    origin Text Maybe
    format ContentType
    data ByteString
